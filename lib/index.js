(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=0)})([function(a,b,c){'use strict';function d(a,b){return a.split('.').reduce((a,b)=>a&&a.hasOwnProperty(b)&&a[b],b)}Object.defineProperty(b,'__esModule',{value:!0});var e=c(1);b['default']=class{constructor(a,{logger:b=console,authorization:c=null,enableExperimentalRouteResolver:d=!1}={}){this.baseUrl=a,this.logger=b,this.authorization=c,this.links=this.fetchLinks(),this.cache={},d&&this.enableExperimentalRouteResolver()}async get(a,b){const c=`${await this.getLink(a)}/${b}`;return this.documentData((await this.fetchDocument(c)))}async findAll(a,{limit:b=-1,sort:c='',filter:d='',relationships:e={}}={}){let f=await this.collectionLink(a,{sort:c,filter:d,page:'page[limit]=50'}),g=this.expandRelationships(e);return this.paginate(f,b,g)}expandRelationships(a){const b=(a,c)=>Object.getOwnPropertyNames(a).reduce((d,e)=>(d[e]=c(a[e]),a[e].relationships&&(d[e].relationships=b(a[e].relationships,c,{})),d),{});return b(a,(a)=>'string'==typeof a?{field:a}:a,{})}paginate(a,b,c){var d=[],e=0;const f=new Set([]),g={};if(c){const a=[`.links.next`],b=(c)=>{Object.getOwnPropertyNames(c).forEach((d)=>{a.push(`.data.[].relationships.${c[d].field}.links.related`),c[d].anticipate&&Object.getOwnPropertyNames(c[d].anticipate).forEach((b)=>{a.push(c[d].anticipate[b])}),c[d].relationships&&b(c[d].relationships)})};b(c),a.length&&(g['x-push-please']=a.join('; '))}const h=(b)=>(f.add(b),this.fetchDocument(b,g).then((c)=>{f.delete(b),a=c.links.next||!1;const g=this.documentData(c),h=Array.isArray(g)?g:[g];return e+=h?h.length:0,d.push(...(h||[])),Promise.resolve(d)}));var i=[];const j=()=>(a&&!f.has(a)&&(-1===b||e<b)&&i.push(h(a)),!d.length&&i.length?i.shift().then(()=>d):Promise.resolve(d));let k=0;const l=function*(){for(;d.length||f.size||a;)yield(-1===b||k<b)&&j().then((a)=>{k++;const b=a.shift();return b||null})}();return l.canContinue=()=>d.length||f.size||a,l.addMore=(a=-1)=>-1===a?b=-1:b+=a,a&&!f.has(a)&&(-1===b||e<b)&&i.push(h(a)),this.toConsumer(l,c)}toConsumer(a,b=null){const c=this;return{consume:function(d,e=!1){const g=[],h=c.decorateWithRelationships((a,b)=>{g.push(e?()=>b?d(a,b):d(a):b?d(a,b):d(a))},b);return new Promise((b,c)=>{const d=(e)=>{e?e.then((b)=>{b&&h(b),d(a.next().value)}).catch(c):Promise.all(g).then(()=>{b(!!a.canContinue()&&a.addMore)}).catch(c)};d(a.next().value)}).then((a)=>new Promise(async(b,c)=>{if(e)for(;g.length;){let a=g.shift(),b=a();b instanceof Promise&&(await b.catch(c))}b(a)}))}}}debugger(){return(a)=>{if(a.errors){a.errors.forEach((a)=>{this.logger.info(`${a.title}: ${a.detail}. %s`,a.links.info)})}else;}}decorateWithRelationships(a,b=null){const c=b?(c)=>{const e={};return Object.getOwnPropertyNames(b).forEach((a)=>{const f=b[a];let g;e[a]=(g=d(`relationships.${f.field}.links.related`,c))?this.paginate(g,f.limit||-1,f.relationships||null):Promise.reject()}),a(c,e)}:a;return c}fetchDocument(a,b={},c={}){const d=Object.assign({headers:new Headers(Object.assign({accept:'application/vnd.api+json'},b)),credentials:'include'},c);return this.authorization&&d.headers.set('authorization',this.authorization),fetch(a,d).then((a)=>a.ok?a.json():new Promise(async(b,c)=>{c((await a.json().catch(()=>{c(a.statusText)})))}))}documentData(a){if(a.hasOwnProperty('data'))return a.data;if(a.hasOwnProperty('errors'))throw new Error(a);else throw new Error('The server returned an unprocessable document with no data or errors.')}getLink(a,b={}){return this.links.then((b)=>(b.hasOwnProperty(a)||Promise.reject(`'${a}' is not a valid type for ${this.baseUrl}.`),this.baseUrl+b[a]))}fetchLinks(){return this.fetchDocument(`${this.baseUrl}/jsonapi`).then((a)=>a.links).catch(this.debugger())}filter(a){return new e.a(a)}async collectionLink(a,{sort:b,filter:c,page:d}={}){let e='';return e+=c.length?`?${c}`:'',e+=b.length?`${e.length?'&':'?'}sort=${b}`:'',e+=d.length?`${e.length?'&':'?'}${d}`:'',`${await this.getLink(a)}${e}`}enableExperimentalRouteResolver(a=!0){this.resolve=a?async(a)=>{try{const b=await this.fetchDocument(`${this.baseUrl}/router/translate-path?path=${a}&_format=json`,{"x-push-please":'.jsonapi.individual',accept:'application/json'});return this.get(b.jsonapi.resourceName,b.entity.uuid)}catch(a){throw new Error(a.message)}}:void 0}}},function(a,b){'use strict';b.a=class{constructor(a){this.conditions=a(d,(a)=>(b)=>b[a])}compile(a){const b=function*(){for(let a=1;;)yield a++}(),c=(e,f,g,h=null)=>{const i=b.next().value,j=e.length?`${e}&`:'';if(f.members){const a=`filter[${i}][group]`,b=h?`${a}[conjunction]=${f.conjunction}&${a}[memberOf]=${h}`:`${a}[conjunction]=${f.conjunction}`;return`${j}${f.members.reduce((a,b,d)=>c(a,b,d,i),b)}`}else{const b=`filter[${i}][condition]`,c=d.process(f,a);let e='';return e+=`${b}[path]=${encodeURIComponent(c.path)}`,d.unaryOperators.has(c.operator)?e+=`&${b}[value]=${encodeURIComponent(c.value)}`:!d.nullOperators.has(c.operator)&&c.value.forEach((a)=>{e+=`&${b}[value][]=${encodeURIComponent(a)}`}),e+=`&${b}[operator]=${encodeURIComponent(c.operator)}`,h?`${j}${e}&${b}[memberOf]=${h}`:`${j}${e}`}};return c('',this.conditions)}};const c={and:(...a)=>c.group(a,'AND'),or:(...a)=>c.group(a,'OR'),group:(a,b)=>({conjunction:b,members:a})},d=function a(b,c){return a.eq(b,c)};d.and=c.and,d.or=c.or,d.eq=(a,b)=>d.condition(a,b,'='),d.notEq=(a,b)=>d.condition(a,b,'<>'),d.gt=(a,b)=>d.condition(a,b,'>'),d.gtEq=(a,b)=>d.condition(a,b,'>='),d.lt=(a,b)=>d.condition(a,b,'<'),d.ltEq=(a,b)=>d.condition(a,b,'<='),d.startsWith=(a,b)=>d.condition(a,b,'STARTS_WITH'),d.contains=(a,b)=>d.condition(a,b,'CONTAINS'),d.endsWith=(a,b)=>d.condition(a,b,'ENDS_WITH'),d.in=(a,b)=>d.condition(a,b,'IN'),d.notIn=(a,b)=>d.condition(a,b,'NOT IN'),d.between=(a,b)=>d.condition(a,b,'BETWEEN'),d.notBetween=(a,b)=>d.condition(a,b,'NOT BETWEEN'),d.null=(a)=>d.condition(a,void 0,'IS NULL'),d.notNull=(a)=>d.condition(a,void 0,'IS NOT NULL'),d.condition=(a,b,c)=>d.validate({path:a,value:b,operator:c}),d.unaryOperators=new Set(['=','<>','>','>=','<','<=','STARTS_WITH','CONTAINS','ENDS_WITH']),d.unaryValueTypes=new Set(['string','boolean','number']),d.binaryOperators=new Set(['BETWEEN','NOT BETWEEN']),d.stringOperators=new Set(['STARTS_WITH','CONTAINS','ENDS_WITH']),d.nullOperators=new Set(['IS NULL','IS NOT NULL']),d.validate=(a)=>{if(a.operator instanceof Function||a.value instanceof Function)return a;if(d.nullOperators.has(a.operator)){if('undefined'!=typeof a.value)throw new Error(`Conditions with an '${a.operator}' operator must not specify a value.`);}else if(d.unaryOperators.has(a.operator)){if(!d.unaryValueTypes.has(typeof a.value))throw new Error(`The '${a.operator}' operator requires a single value.`);if(d.stringOperators.has(a.operator)&&'string'!=typeof a.value)throw new Error(`The '${a.operator}' operator requires that the condition value be a string.`)}else{if(!Array.isArray(a.value))throw new Error(`The '${a.operator}' operator requires an array of values.`);if(d.binaryOperators.has(a.operator)&&2!==a.value.length)throw new Error(`The '${a.operator}' operator requires an array of exactly 2 values.`)}return a},d.process=(a,b)=>{let c=!1;const e=(a)=>a instanceof Function?(c=!0,a(b)):a,f={path:e(a.path),operator:e(a.operator)};return d.nullOperators.has(f.operator)||(f.value=e(a.value)),c&&d.validate(f),f}}]);